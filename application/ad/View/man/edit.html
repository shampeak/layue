{php}
    $id = request()->get('id');
    $id = intval($id);
    $row = md('ad')->find($id);     //获得广告数据
    if(empty($row))return '广告主体缺失';

    $mbid = intval($row['spId']);
    $rowsp = md('adsp')->find($mbid);
    $adconfig = $rowsp['config'];
    $config = json_decode($adconfig,true);

//print_r($config);


{/php}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>layuiAdmin 角色管理 iframe 框</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="../../../layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/static/Sham.css" media="all">
</head>
<body>

<div class="layui-card-body">
    <div class="layui-tab">
        <ul class="layui-tab-title">
            <li class="layui-this">内容设置</li>
            <li>Html</li>
        </ul>
        <div class="layui-tab-content">
            <div class="layui-tab-item layui-show text-sm">
                <!-- 第一标签页 -->
                <div class="layui-form" lay-filter="layuiadmin-form-role" id="layuiadmin-form-role" style="padding: 20px 30px 0 0;">
                    <form id="layuiadmin-form-edit" action="" method="post">

                        {if $config['title']}
                        <div class="layui-form-item">
                            <label class="layui-form-label">文字</label>
                            <div class="layui-input-block">
                                <input type="text" name="title" value="{$row['title']}" lay-verify="required" placeholder="频道名称" autocomplete="off" class="layui-input layui-input-sm">
                            </div>
                        </div>
                        {/if}

                        {if $config['summary']}
                        <div class="layui-form-item">
                            <label class="layui-form-label">摘要</label>
                            <div class="layui-input-block">
                                <input type="text" name="summary"  value="{$row['summary']}" lay-verify="required" placeholder="字符标识" autocomplete="off" class="layui-input layui-input-sm">
                            </div>
                        </div>
                        {/if}

                        {if $config['img']}
                        <div class="layui-form-item">
                            <label class="layui-form-label">图片</label>
                            <div class="layui-input-block">
                                <div class="layui-upload">
                                    <input type="hidden" id="editimg" name="img"  value="{$row['img']|default='/static/default.gif'}">
                                    <!--res.file_path-->
                                    <button type="button" class="layui-btn layui-btn-sm" id="test-upload-normal">上传图片</button>
                                    <div class="layui-upload-list">
                                        <img class="layui-upload-img" id="test-upload-normal-img" src="{$row['img']|default='/static/default.gif'}">
                                        <p id="test-upload-demoText"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {/if}

                        {if $config['url']}
                        <div class="layui-form-item">
                            <label class="layui-form-label">链接</label>
                            <div class="layui-input-block">
                                <input type="text" name="url"  value="{$row['url']}" lay-verify="required" placeholder="描述" autocomplete="off" class="layui-input layui-input-sm">
                            </div>
                        </div>
                        {/if}


                        <div class="layui-form-item layui-hide">
                            <input type="text" name="aId" value="{$row['aId']}">
                            <button class="layui-btn" lay-submit lay-filter="LAY-user-role-submit" id="LAY-user-role-submit">提交</button>
                        </div>
                    </form>
                </div>
<!--标签页1-->
            </div>
            <div class="layui-tab-item">
                <!--标签三-->
                <textarea placeholder="" lay-verify="required" autocomplete="off" class="layui-textarea layui-textarea-sm">{:ad($row['aId'])}</textarea>
                <!--标签三结束-->
                <h3>{$rowsp['title']} <small>{$rowsp['dis']}</small></h3>
                <blockquote class="layui-elem-quote layui-quote-nm">{$adconfig}</blockquote>
                <h3>碎片模板</h3>
                <pre>{$rowsp['nr']|htmlspecialchars}</pre>

            </div>

        </div>
    </div>





<script src="../../../layuiadmin/layui/layui.js"></script>
<script>
    layui.config({
        base: '../../../layuiadmin/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index','upload', 'form'], function(){
        var $ = layui.$
            ,form = layui.form
            ,upload = layui.upload;




        //上传头像
        var avatarSrc = $('#LAY_avatarSrc');
        upload.render({
            url: '/main/json/uploadimg'
            ,elem: '#LAY_avatarUpload'
            ,done: function(res){
                if(res.status == 0){
                    avatarSrc.val(res.file_path);
                } else {
                    layer.msg(res.msg, {icon: 5});
                }
            }
        });

        //普通图片上传
        var uploadInst = upload.render({
            elem: '#test-upload-normal'
            ,url: '/main/json/uploadimg/'
            ,before: function(obj){
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                    $('#test-upload-normal-img').attr('src', result); //图片链接（base64）
                });
            }
            ,done: function(res){
                //如果上传失败
                if(res.code > 0){
                    return layer.msg('上传失败');
                }
                //上传成功
                $('#test-upload-normal-img').attr('src', res.file_path); //图片链接（base64）
                //隐藏的表单设置为图片路径
                $('#editimg').val(res.file_path);
            }
            ,error: function(){
                //演示失败状态，并实现重传
                var demoText = $('#test-upload-demoText');
                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-mini demo-reload">重试</a>');
                demoText.find('.demo-reload').on('click', function(){
                    uploadInst.upload();
                });
            }
        });











    })
</script>
</body>
</html>